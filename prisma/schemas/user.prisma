// prisma/schemas/user.prisma
// ===== USER MANAGEMENT SCHEMA - InvenStock V1.0 =====

model User {
  id          String     @id @default(cuid())
  email       String     @unique
  username    String?    @unique
  password    String     // bcrypt hashed
  
  // Personal Information
  firstName   String
  lastName    String
  avatar      String?    // URL to profile picture
  phone       String?
  
  // Account Status
  status      UserStatus @default(PENDING)
  isActive    Boolean    @default(true)
  emailVerified Boolean  @default(false)
  
  // Security
  lastLogin   DateTime?
  lastLoginIp String?
  
  // Preferences
  language    String     @default("th")
  timezone    String     @default("Asia/Bangkok")
  
  // Timestamps
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  organizationUsers     OrganizationUser[]
  organizationUserRoles OrganizationUserRole[]
  sentInvitations       UserInvitation[] @relation("InviterUser")
  receivedInvitations   UserInvitation[] @relation("InviteeUser")
  stockTransactions     StockTransaction[]
  transfersRequested    Transfer[] @relation("RequesterUser")
  transfersApproved     Transfer[] @relation("ApproverUser") 
  transfersDispatched   Transfer[] @relation("DispatcherUser")
  transfersReceived     Transfer[] @relation("ReceiverUser")
  notifications         Notification[]
  auditLogs            AuditLog[]
  
  @@index([email])
  @@index([status])
  @@index([isActive])
  @@map("users")
}

// User Invitations for joining organizations
model UserInvitation {
  id             String           @id @default(cuid())
  organizationId String
  inviterId      String
  inviteeId      String?          // null if inviting by email
  inviteeEmail   String
  
  // Invitation Details
  roleId         String?          // ðŸ”¥ FIXED: Single role ID instead of array
  message        String?          // Personal message
  
  // Status
  status         InvitationStatus @default(PENDING)
  expiresAt      DateTime         // Invitation expiry
  
  // Response
  respondedAt    DateTime?
  response       String?          // Reason for decline
  
  // Timestamps
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  
  // Relations
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  inviter        User             @relation("InviterUser", fields: [inviterId], references: [id])
  invitee        User?            @relation("InviteeUser", fields: [inviteeId], references: [id])
  
  @@unique([organizationId, inviteeEmail])
  @@index([status])
  @@index([expiresAt])
  @@map("user_invitations")
}