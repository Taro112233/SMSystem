// prisma/schemas/product.prisma
// ===== PRODUCT MANAGEMENT SCHEMA - InvenStock V1.0 =====

// Custom Product Categories per Organization
model ProductCategory {
  id             String       @id @default(cuid())
  organizationId String
  parentId       String?      // For hierarchical structure
  
  // Category Details
  name           String
  code           String?      // Category code
  description    String?
  color          String?      // Hex color for UI
  icon           String?      // Icon name or emoji
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  parent         ProductCategory? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children       ProductCategory[] @relation("CategoryHierarchy")
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([parentId])
  @@index([sortOrder])
  @@map("product_categories")
}

// Custom Product Types per Organization
model ProductType {
  id             String       @id @default(cuid())
  organizationId String
  
  // Type Details
  name           String       // ‡πÄ‡∏ä‡πà‡∏ô "‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î", "‡∏¢‡∏≤‡∏ô‡πâ‡∏≥", "‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå"
  code           String?      // ‡∏£‡∏´‡∏±‡∏™‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
  description    String?
  color          String?      // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI
  icon           String?      // ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([isActive])
  @@map("product_types")
}

// Custom Product Forms per Organization  
model ProductForm {
  id             String       @id @default(cuid())
  organizationId String
  
  // Form Details
  name           String       // ‡πÄ‡∏ä‡πà‡∏ô "‡πÄ‡∏°‡πá‡∏î", "‡πÅ‡∏Ñ‡∏õ‡∏ã‡∏π‡∏•", "‡∏ô‡πâ‡∏≥", "‡∏Ñ‡∏£‡∏µ‡∏°"
  code           String?      // ‡∏£‡∏´‡∏±‡∏™‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
  description    String?
  
  // Settings
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  products       Product[]
  
  @@unique([organizationId, name])
  @@index([isActive])
  @@map("product_forms")
}

// Products with Custom Organization Fields
model Product {
  id             String          @id @default(cuid())
  organizationId String
  categoryId     String?         // ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  typeId         String?         // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (custom per org)
  formId         String?         // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (custom per org)
  
  // Product Identification - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  orgProductCode String          // ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ (required)
  sku            String?         // Stock Keeping Unit (optional)
  barcode        String?         // Barcode/QR code
  
  // Product Details - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  name           String          // ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (required)
  description    String?         // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (optional)
  
  // Product Specifications - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  strength       String?         // ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "500mg")
  volume         String?         // ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "100ml")
  qtyPerBox      Int             @default(1) // ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏Å‡∏•‡πà‡∏≠‡∏á (required, default 1)
  
  // Additional Details
  brand          String?         // Brand/Manufacturer
  model          String?         // Model number
  unit           UnitType        @default(PIECE)
  unitName       String?         // Custom unit name
  
  // Physical Properties
  weight         Float?          // Weight in grams
  dimensions     String?         // JSON: {length, width, height}
  
  // Inventory Settings
  trackBatches   Boolean         @default(true)  // Enable batch/lot tracking (default true for pharmacy)
  trackExpiry    Boolean         @default(true)  // Track expiry dates (default true for pharmacy)
  minStockLevel  Int             @default(0)     // Minimum stock alert
  maxStockLevel  Int?            // Maximum stock limit
  
  // Status & Settings - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  status         ProductStatus   @default(ACTIVE)
  isActive       Boolean         @default(true)  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (required)
  
  // Media - üî• FIXED: Using JSON instead of String[]
  images         String?         // JSON array of image URLs
  documents      String?         // JSON array of document URLs
  
  // Custom Fields (JSON)
  customFields   String?         // JSON object for custom data
  
  // Audit Fields
  createdBy      String          // User who created
  updatedBy      String?         // User who last updated
  
  // Timestamps
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  
  // Relations
  organization   Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  category       ProductCategory? @relation(fields: [categoryId], references: [id])
  productType    ProductType?    @relation(fields: [typeId], references: [id])
  productForm    ProductForm?    @relation(fields: [formId], references: [id])
  batches        ProductBatch[]
  stocks         Stock[]
  transferItems  TransferItem[]
  
  @@unique([organizationId, orgProductCode]) // ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
  @@index([isActive])
  @@index([categoryId])
  @@index([typeId])
  @@index([formId])
  @@index([barcode])
  @@map("products")
}

// Product Batches for Lot/Expiry/Price Tracking - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
model ProductBatch {
  id             String       @id @default(cuid())
  productId      String
  
  // Batch Details - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  batchNumber    String       // Lot/Batch number (required)
  expiryDate     DateTime?    // ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (optional)
  manufactureDate DateTime?   // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏•‡∏¥‡∏ï (optional)
  supplier       String?      // ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢ (optional)
  
  // Pricing - ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ï‡πà‡∏•‡∏∞ lot ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô)
  costPrice      Float        @default(0) // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏•‡πà‡∏≠‡∏á (required)
  sellingPrice   Float        @default(0) // ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏•‡πà‡∏≠‡∏á (required)
  
  // Quantity Tracking
  initialQty     Int          @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  currentQty     Int          @default(0) // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
  
  // Status
  isActive       Boolean      @default(true)
  
  // Audit Fields
  createdBy      String       // User who created
  updatedBy      String?      // User who last updated
  
  // Timestamps
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  product        Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  stockTransactions StockTransaction[]
  transferItems  TransferItem[]
  
  @@unique([productId, batchNumber]) // ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ batch number ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
  @@index([expiryDate])
  @@index([isActive])
  @@index([costPrice])
  @@map("product_batches")
}